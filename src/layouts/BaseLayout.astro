---
import { siteConfig } from '../site.config';
import Nav from '../components/UI/Nav.astro';
import Footer from '../components/UI/Footer.astro';
import '../styles/tailwind.css';

export interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  image?: string;
  noIndex?: boolean;
}

const { 
  title = siteConfig.title,
  description = siteConfig.description,
  keywords = 'AI自动化, 数字化转型, 业务流程优化, 人工智能解决方案, 自动化工具',
  image = '/og-default.png',
  noIndex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, siteConfig.siteUrl);

// JSON-LD structured data
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: siteConfig.title,
  description: siteConfig.description,
  url: siteConfig.siteUrl,
  logo: `${siteConfig.siteUrl}/logo.svg`,
  contactPoint: {
    '@type': 'ContactPoint',
    email: siteConfig.email,
    contactType: 'customer service'
  },
  sameAs: [
    siteConfig.social.twitter,
    siteConfig.social.linkedin,
    siteConfig.social.github
  ]
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: siteConfig.title,
  description: siteConfig.description,
  url: siteConfig.siteUrl,
  potentialAction: {
    '@type': 'SearchAction',
    target: `${siteConfig.siteUrl}/search?q={search_term_string}`,
    'query-input': 'required name=search_term_string'
  }
};
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- Primary Meta Tags -->
  <title>{title}</title>
  <meta name="title" content={title}>
  <meta name="description" content={description}>
  <meta name="keywords" content={keywords}>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={new URL(image, siteConfig.siteUrl)}>
  <meta property="og:site_name" content={siteConfig.title}>
  <meta property="og:locale" content="zh_CN">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content={canonicalURL}>
  <meta property="twitter:title" content={title}>
  <meta property="twitter:description" content={description}>
  <meta property="twitter:image" content={new URL(image, siteConfig.siteUrl)}>
  
  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalURL}>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" href="/favicon.ico">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  <!-- Web Manifest -->
  <link rel="manifest" href="/site.webmanifest">
  
  <!-- Theme Color -->
  <meta name="theme-color" content="#245BFF">
  <meta name="msapplication-TileColor" content="#245BFF">
  
  <!-- Robots -->
  {noIndex && <meta name="robots" content="noindex, nofollow">}
  
  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema, null, 2)} />
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema, null, 2)} />
  
  <!-- Preload critical fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Analytics placeholder -->
  <slot name="analytics" />
</head>

<body class="min-h-screen flex flex-col">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-500 text-white px-4 py-2 rounded-lg z-50">
    跳转到主内容
  </a>
  
  <!-- Navigation -->
  <Nav />
  
  <!-- Main Content -->
  <main id="main-content" class="flex-grow">
    <slot />
  </main>
  
  <!-- Footer -->
  <Footer />
  
  <!-- Scripts -->
  <script>
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
    
    // Add loading animation
    window.addEventListener('load', () => {
      document.body.classList.add('loaded');
    });
  </script>
</body>
</html>